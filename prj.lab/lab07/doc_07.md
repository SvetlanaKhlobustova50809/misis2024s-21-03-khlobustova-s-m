# Введение
Целью данного отчета является описание реализации метода сегментации изображений с использованием алгоритма k-means, оценка качества полученной сегментации и сравнение её с бинаризацией.

# Описание этапов реализации кода

Определение структуры Circle, которая содержит координаты центра и радиус круга. Затем создается вектор groundTruth для хранения данных о кругах.

Функция generateTestImage создает пустое изображение размером 550x550 пикселей с черным фоном. В этой функции также определяется шаг контраста и размера. В двойном цикле по i и j рассчитываются контраст и размер кругов. Если круг с заданными параметрами помещается в изображение, его данные добавляются в вектор groundTruth.

Количество кластеров для сегментации устанавливается равным 3, после чего выполняется сегментация изображения с помощью функции segmentImageKMeans.

Метод сегментации с использованием k-means
- В качестве основы для сегментации выбран алгоритм k-means, который разбивает изображение на заданное количество кластеров.
- Исходное изображение представляется в виде матрицы samples, где каждый пиксель представлен вектором из трех компонент (для RGB изображений).
- Производится итеративное обучение алгоритма k-means с заданным числом попыток attempts, используя предопределенные центры кластеров.
- Для каждого пикселя определяется принадлежность к одному из кластеров на основе меток labels, полученных в результате обучения.
- Итоговое сегментированное изображение формируется путем замены цветовых значений пикселей на центры кластеров.

Сегментированное изображение преобразуется в оттенки серого, затем размывается с использованием гауссова размытия.

С помощью преобразования Хафа ищутся круги в изображении. После этого изображение бинаризуется методом Отсу и к нему применяется морфологическая операция закрытия для улучшения выделения контуров.

Контуры находятся в бинаризованном изображении, и для каждого контура вычисляется минимальная охватывающая окружность. Найденные окружности сохраняются в вектор detected.

Обнаруженные контуры рисуются на изображении, результат отображается и сохраняется на диск.

Метод оценки качества сегментации
- Для оценки качества сегментации используется метод evaluateSegmentation, который сравнивает сегментированное изображение с эталонной разметкой (заданной в том же формате и размере).
- Подсчитывается количество пикселей, совпадающих между сегментированным изображением и эталоном.
- Вычисляется процент правильно сегментированных пикселей от общего числа пикселей на изображении
- Функция calculateIoU вычисляет коэффициент пересечения (Intersection over Union, IoU) двух прямоугольников. Сначала вычисляется площадь пересечения, затем площадь объединения, и возвращается их отношение.
- Функция evaluateDetection оценивает точность обнаружения кругов, сравнивая обнаруженные круги с кругами из groundTruth. Функция подсчитывает количество истинно положительных (TP), ложно положительных (FP) и ложно отрицательных (FN) срабатываний на основе порога IoU. Для каждого круга из ground truth проверяется, есть ли пересечение с обнаруженными кругами, превышающее заданный порог.

# Сравнение сегментационного метода и бинаризации
- В контексте данного отчета сравнение проводится по точности сегментации, которая измеряется как процент правильно классифицированных пикселей от общего числа пикселей.
- Бинаризация, как более простой метод, не учитывает цветовую информацию и разделяет изображение на два класса (например, черно-белое изображение).

# Результат:

<picture>
  <img src="./lab07_test_image.png" width="550" height="550">
</picture>
   
Рис. 1 – Тестовое изображение 1

<picture>
  <img src="../../pictures/lab07_segm1.png" width="550" height="550">
</picture>
   
Рис. 2 – Сегментированное изображение 1 с параметром k = 3

<picture>
  <img src="../../pictures/lab07_segm_res1.png" width="550" height="550">
</picture>
   
Рис. 3 – Детектированное изображение 1

<picture>
  <img src="../../pictures/lab07_segm2.png" width="550" height="550">
</picture>
   
Рис. 4 – Сегментированное изображение 2 с параметром k = 6

<picture>
  <img src="../../pictures/lab07_segm_res2.png" width="550" height="550">
</picture>
   
Рис. 5 – Детектированное изображение 2

<picture>
  <img src="../../pictures/lab04_test1.png" width="550" height="550">
</picture>
   
Рис. 6 – Тестовое изображение 2

<picture>
  <img src="../../pictures/lab07_segm3.png" width="550" height="550">
</picture>
   
Рис. 7 – Сегментированное изображение 3 с параметром k = 3

<picture>
  <img src="../../pictures/lab07_segm_res3.png" width="550" height="550">
</picture>
   
Рис. 8 – Детектированное изображение 3

# Оценке качества

|Number of detection|True Positives|False Positives|False Negatives|Average IoU|
|-|-|--------|---|-|
|1|80|19|20|0.67|
|2|79|12|21|0.71|
|3|100|0|0|1|

# Выводы
Реализованный метод сегментации на основе алгоритма k-means показал хорошие результаты для данного примера изображения. Полученная точность сегментации составила не менее 67%, что указывает на эффективность метода в разделении изображения на несколько кластеров схожих цветов.

Сравнение с бинаризацией показало, что использование метода k-means позволяет учесть цветовую информацию и достигнуть более точной сегментации, чем простая бинаризация.

Таким образом, предложенный метод сегментации на основе k-means подходит для задач разделения изображений на регионы схожих цветов и может быть дальше улучшен и адаптирован для различных типов изображений и задач компьютерного зрения.

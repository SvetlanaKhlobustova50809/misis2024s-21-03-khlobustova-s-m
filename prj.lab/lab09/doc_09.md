# Введение
Цель данного задания заключается в реализации алгоритма "Gray World" для автоматической балансировки белого цвета на изображении. Алгоритм основан на предположении, что средние значения интенсивностей каналов RGB должны быть равны, что соответствует нейтрально-серому цвету. Этот метод корректирует цвета изображения так, чтобы его общий тон стал более нейтральным и естественным.

# Основные этапы
1. Входное изображение загружается с использованием функции imread.
2. После успешной загрузки изображения вычисляются средние значения для каждого цветового канала (R, G, B) с помощью функции mean. Это позволяет определить, насколько каждый канал отклоняется от среднего значения, которое должно быть достигнуто для получения нейтрального серого цвета.
3. На основе вычисленных средних значений для каждого канала рассчитываются коэффициенты коррекции. Среднее значение всех каналов (avgGray) используется для вычисления коэффициентов для каждого канала:
- kB для синего канала,
- kG для зеленого канала,
- kR для красного канала.
Эти коэффициенты позволяют масштабировать значения каждого канала так, чтобы их средние значения стали равными.
4. Затем осуществляется коррекция значений пикселей каждого канала изображения. Для этого каждый пиксель умножается на соответствующий коэффициент коррекции. Для приведения результатов в допустимый диапазон значений (0-255) используется функция saturate_cast.
5. После применения алгоритма откорректированное изображение отображается с использованием функций imshow. Оригинальное и сбалансированное изображения показываются в отдельных окнах для визуального сравнения. Также результат сохраняется на диск с помощью функции imwrite.

# Описание функции оценки качества
Оценка качества изображения после применения метода серого мира выполняется с помощью двух метрик: индекса цветности (Colorfulness Index) и среднеквадратичной ошибки (MSE). Эти метрики помогают понять, насколько успешно выполнено цветовое балансирование.

Индекс цветности используется для оценки визуальной насыщенности и цветности изображения. Он основан на преобразовании изображения в цветовое пространство Lab, где компоненты L, a и b представляют яркость, красно-зеленую и желто-синюю цветовые компоненты соответственно.

Преобразование в цветовое пространство Lab:

Изображение преобразуется из цветового пространства BGR (Blue, Green, Red) в цветовое пространство Lab. Это делается с помощью функции cvtColor.
Вычисление среднего и стандартного отклонения:

Для каждого канала Lab (L, a, b) вычисляются среднее значение и стандартное отклонение с помощью функции meanStdDev.
Вычисление индекса цветности:

Индекс цветности рассчитывается как сумма двух величин: корня квадратного из суммы квадратов стандартных отклонений каналов a и b, и произведения 0.3 на корень квадратный из суммы квадратов средних значений каналов a и b.

Формула выглядит следующим образом:​

$$ Colorfulness = \sqrt{sigma} $$
​
 
​+ 0.3 * \sqrt{mue}
 +0.3⋅ 
μ 
ab
2
  — стандартное отклонение каналов a и b,
  — среднее значение каналов a и b.
  
Среднеквадратичная ошибка (MSE)
MSE используется для оценки разницы между двумя изображениями. Она вычисляет среднеквадратичное отклонение между соответствующими пикселями двух изображений.

Вычисление абсолютной разницы:

Сначала вычисляется абсолютная разница между соответствующими пикселями исходного и сбалансированного изображений с помощью функции absdiff.
Конвертация в тип float:

Результирующее изображение конвертируется в тип CV_32F для точных вычислений.
Возведение в квадрат:

Каждый элемент матрицы возводится в квадрат для получения квадрата разницы между пикселями.
Вычисление суммы элементов:

Вычисляется сумма всех элементов матрицы.
Вычисление средней ошибки:

Сумма всех элементов делится на количество пикселей в изображении и количество цветовых каналов для получения средней ошибки.
Формула выглядит следующим образом:
​
  — исходное и сбалансированное изображения соответственно.
Функция measureQuality
Эта функция вычисляет обе метрики и выводит результаты:

Вычисление индекса цветности для исходного и сбалансированного изображений:

Используется функция calculateColorfulnessIndex.
Вычисление MSE между исходным и сбалансированным изображениями:

Используется функция calculateMSE.
Вывод результатов:

Результаты индексов цветности и MSE выводятся на экран для оценки изменений.

# Результат

<picture>
  <img src="../../pictures/lab03_test1.jpg" width="960" height="612">
</picture>
   
Рис. 1 – тестовое изображение 1

<picture>
  <img src="../../pictures/lab03_test2.jpg" width="550" height="400">
</picture>
   
Рис. 2 – тестовое изображение 2

<picture>
  <img src="../../pictures/lab09_gray_world_balanced1.jpg" width="960" height="612">
</picture>
   
Рис. 3 – откорректированное изображение 1

<picture>
  <img src="../../pictures/lab09_gray_world_balanced.jpg" width="550" height="400">
</picture>
   
Рис. 4 – откорректированное изображение 2

# Вывод
В результате выполнения задания был реализован и протестирован алгоритм "Gray World" для автоматической балансировки белого цвета на изображении. Применение данного алгоритма позволяет улучшить цветовой баланс изображения, сделав его более естественным и нейтральным по тону. Это особенно полезно в условиях, где освещение неравномерно и требует коррекции для более точной цветопередачи.

